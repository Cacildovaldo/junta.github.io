<!DOCTYPE html>
<html>
<head>
  <title>Bitnest BTN Interface</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
</head>
<body>
  <h2>Bitnest (BTN) Token Interface</h2>
  <button onclick="connectWallet()">ðŸ”Œ Conectar Carteira</button>
  <p id="account">Carteira: nÃ£o conectada</p>
  <p id="price">PreÃ§o Atual BTN: ...</p>
  <p id="balance">Saldo BTN: ...</p>

  <h3>ðŸŸ¢ Comprar BTN</h3>
  <input type="number" id="bnbAmount" placeholder="Valor em BNB">
  <button onclick="buyBTN()">Comprar</button>

  <h3>ðŸ”´ Vender BTN</h3>
  <input type="number" id="tokenAmount" placeholder="Qtd. de BTN">
  <button onclick="sellBTN()">Vender</button>

  <script>
    let web3, contract;
    const contractAddress = "0xC1CaDF1d951Aa21CB3047eBD181dc3c9e4a531b4";
    const ABI = [
  {
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "buyer",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "amountSpent",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "tokensBought",
        "type": "uint256"
      }
    ],
    "name": "Buy",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "seller",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "tokensSold",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "amountReturned",
        "type": "uint256"
      }
    ],
    "name": "Sell",
    "type": "event"
  },
  {
    "inputs": [],
    "name": "buy",
    "outputs": [],
    "stateMutability": "payable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
    ],
    "name": "sell",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "getCurrentPrice",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "account",
        "type": "address"
      }
    ],
    "name": "balanceOf",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  }
];

    async function connectWallet() {
      if (window.ethereum) {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        web3 = new Web3(window.ethereum);
        const accounts = await web3.eth.getAccounts();
        document.getElementById("account").innerText = "Carteira: " + accounts[0];
        contract = new web3.eth.Contract(ABI, contractAddress);
        getPrice();
        getBalance();
      } else {
        alert("Instale a MetaMask!");
      }
    }

    async function getPrice() {
      const price = await contract.methods.getCurrentPrice().call();
      document.getElementById("price").innerText = "PreÃ§o Atual BTN: " + web3.utils.fromWei(price, "ether") + " BNB";
    }

    async function getBalance() {
      const accounts = await web3.eth.getAccounts();
      const balance = await contract.methods.balanceOf(accounts[0]).call();
      document.getElementById("balance").innerText = "Saldo BTN: " + web3.utils.fromWei(balance, "ether");
    }

    async function buyBTN() {
      const accounts = await web3.eth.getAccounts();
      const bnbAmount = document.getElementById("bnbAmount").value;
      await contract.methods.buy().send({
        from: accounts[0],
        value: web3.utils.toWei(bnbAmount, "ether")
      });
      getPrice();
      getBalance();
    }

    async function sellBTN() {
      const accounts = await web3.eth.getAccounts();
      const tokenAmount = document.getElementById("tokenAmount").value;
      const amountInWei = web3.utils.toWei(tokenAmount, "ether");
      await contract.methods.sell(amountInWei).send({ from: accounts[0] });
      getPrice();
      getBalance();
    }
  </script>
</body>
</html>
